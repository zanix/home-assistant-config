###########################################################
# Package: Weather
#   Automation is located in the automation directory
###########################################################

homeassistant:
  customize:
    sensor.weather_minutely_summary:
      hidden: true
    sensor.weather_icon:
      hidden: true
    sensor.weather_daily_max_precip_intensity:
      icon: mdi:ruler

sun:

recorder:
  exclude:
    entities:
    - sensor.weather_icon
    - sensor.weather_daily_summary
    - sensor.weather_hourly_summary
    - sensor.sunset_time
    - sensor.sunrise_time

influxdb:
  exclude:
    entities:
    - sensor.weather_icon
    - sensor.weather_daily_summary
    - sensor.weather_hourly_summary
    - sensor.sunset_time
    - sensor.sunrise_time

sensor:
  - platform: template
    sensors:
      sunrise_time:
        friendly_name: "Sunrise"
        entity_id: sun.sun
        value_template: "{% set timestamp = as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom('%I:%M %p') %}{{ timestamp.lstrip('0') }}"
        icon_template: mdi:weather-sunset-up

      sunset_time:
        friendly_name: "Sunset"
        entity_id: sun.sun
        value_template: "{% set timestamp = as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom('%I:%M %p') %}{{ timestamp.lstrip('0') }}"
        icon_template: mdi:weather-sunset-down

      weather_summary_icon:
        friendly_name: Weather Summary
        value_template: "{{ states('sensor.weather_minutely_summary') }}"
        icon_template: >
          {% if is_state('sensor.weather_icon', 'clear-day') %}
            mdi:weather-sunny
          {% elif is_state('sensor.weather_icon', 'clear-night') %}
            mdi:weather-night
          {% elif is_state('sensor.weather_icon', 'rain') %}
            mdi:weather-rainy
          {% elif is_state('sensor.weather_icon', 'snow') %}
            mdi:weather-snowy
          {% elif is_state('sensor.weather_icon', 'sleet') %}
            mdi:weather-snowy-rainy
          {% elif is_state('sensor.weather_icon', 'wind') %}
            mdi:weather-windy
          {% elif is_state('sensor.weather_icon', 'fog') %}
            mdi:weather-fog
          {% elif is_state('sensor.weather_icon', 'cloudy') %}
            mdi:weather-cloudy
          {% elif is_state('sensor.weather_icon', 'partly-cloudy-day') or is_state('sensor.weather_icon', 'partly-cloudy-night') %}
            mdi:weather-partlycloudy
          {% elif is_state('sensor.weather_icon', 'hail') %}
            mdi:weather-hail
          {% elif is_state('sensor.weather_icon', 'thunderstorm') %}
            mdi:weather-lightning
          {% else %}
            mdi:help-circle
          {% endif %}

  - platform: moon

  - platform: darksky
    name: Weather
    api_key: !secret darksky_api_key
    update_interval:
      minutes: 5
    forecast:
      - 1
      - 2
      - 3
      - 4
      - 5
    monitored_conditions:
      # - summary
      - minutely_summary
      # - hourly_summary
      - daily_summary
      - icon
      # - nearest_storm_distance
      # - nearest_storm_bearing
      - precip_type
      - precip_intensity
      # - precip_probability
      # - precip_accumulation
      - temperature
      # - apparent_temperature
      # - dew_point
      - wind_speed
      - wind_bearing
      - cloud_cover
      - humidity
      - pressure
      - visibility
      # - ozone
      # - apparent_temperature_high
      # - apparent_temperature_low
      - temperature_high
      - temperature_low
      - precip_intensity_max
      - uv_index

  - platform: pollen
    zip_code: !secret pollen_zip_code
    monitored_conditions:
      - allergy_average_forecasted
      - allergy_average_historical
      - allergy_index_today
      - allergy_index_tomorrow
      - allergy_index_yesterday
      - disease_average_forecasted
