---
id: delivery_packages_delivered
alias: '[Delivery] Packages Delivered'
description: 'Notifies when packages have been delivered'

trigger:
  - platform: numeric_state
    entity_id: sensor.mail_packages_delivered
    above: 0

condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != "unavailable" and trigger.from_state.state != "unavailable" }}'
  - condition: template
    value_template: '{{ (trigger.to_state.state|int(default=0)) != (trigger.from_state.state|int(default=0)) }}'

action:
  - service: script.notify_mobile
    data:
      who: 'parents'
      title: 'Package Delivery'
      message: '{{ trigger.to_state.state }} {% if trigger.to_state.state == "1" %}package is{% else %}packages are{% endif %} delivered.'
      icon: '/local/icons/package-variant.png'
      group: 'Delivery'
      tag: 'delivery-packages-delivered'
