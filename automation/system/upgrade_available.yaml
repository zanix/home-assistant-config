---
id: system_upgrade_available
alias: '[System] Upgrade Available'
description: 'Sends a notification when a new release of Home Assistant is released'

trigger:
  platform: state
  entity_id: sensor.available_version

condition:
  condition: template
  value_template: >-
    {{ states('sensor.available_version') != states('sensor.current_version') }}

action:
  - service: script.notify_web
    data:
      title: 'Upgrade Available'
      message: '**Home Assistant** _{{ states("sensor.current_version") }}_ -> [_{{ states("sensor.available_version") }}_]({{ state_attr("binary_sensor.updater", "release_notes") }})'
      id: 'upgrade-available'

  - service: script.notify_mobile
    data:
      who: 'josh'
      title: 'Upgrade Available'
      message: '<b>Home Assistant</b> <em>{{ states("sensor.current_version") }}</em> -> <em>{{ states("sensor.available_version") }}</em>'
      icon: '/local/icons/update.png'
      url: '{{ state_attr("binary_sensor.updater", "release_notes") }}'
      group: 'upgrade-available'
      tag: 'upgrade-available'
