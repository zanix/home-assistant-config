---
id: potty_time
alias: '[Notify] Potty Time'
description: 'Reminder to go potty'
mode: single

trigger:
  - platform: time_pattern
    hours: '*'

condition:
  - condition: state
    entity_id: input_boolean.audio_notifications
    state: 'on'
  - condition: template
    value_template: >-
      {% set current_time = (now().second + (now().minute * 60) + (now().hour * 3600)) %}
      {% set start = state_attr('input_datetime.audio_notifications_start', 'timestamp') | int %}
      {% set end = state_attr('input_datetime.audio_notifications_end', 'timestamp') | int %}
      {% set nap_start = state_attr('input_datetime.nap_time_start', 'timestamp') | int %}
      {% set nap_end = state_attr('input_datetime.nap_time_end', 'timestamp') | int %}
      {{ (start <= current_time <= end) and (nap_start > current_time or current_time > nap_end) }}

action:
  - service: media_player.volume_set
    data:
      volume_level: 0.4
    target:
      entity_id: media_player.living_room_speaker

  - service: media_player.play_media
    data:
      media_content_type: audio/opus
      media_content_id: '{{ states.sensor.base_url.state }}/local/sounds/clementine.opus'
    target:
      entity_id: media_player.living_room_speaker

  - delay:
      seconds: 20

  - service: media_player.media_stop
    target:
      entity_id: media_player.living_room_speaker

  - service: media_player.volume_set
    data:
      volume_level: 0.5
    target:
      entity_id: media_player.living_room_speaker
