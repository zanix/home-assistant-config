---
id: notify_door_opened_and_away
alias: '[Notify] Door Opened and Away'
description: 'Sends notification if a door is open when people are away'

trigger:
  platform: state
  entity_id: !include ../../templates/doors.yaml
  from: 'off'
  to: 'on'

condition:
  - condition: state
    entity_id: group.people
    state: 'not_home'
  - condition: state
    entity_id: input_boolean.ignore_alert_doors
    state: 'off'

action:
  - service: script.notify_mobile
    data:
      who: 'parents'
      title: 'Door Opened'
      message: 'The {{ trigger.to_state.attributes.friendly_name }} opened and no one is home.'
      icon: '/local/icons/door-open.png'
      group: 'Security'
      tag: 'door-{{ trigger.to_state.object_id }}'
      url: 'lovelace/security'
      actions:
        - action: 'ignore_door_alerts'
          title: 'Ignore'
