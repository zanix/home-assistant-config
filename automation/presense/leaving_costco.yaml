---
alias: "[Presense] Leaving Costco"
description: "Sends a notification when someone is leaving Costco"
mode: single
trigger:
  platform: zone
  event: leave
  zone: zone.costco
  entity_id:
    - person.joshua
    - person.amy
condition:
  condition: time
  after: '08:00'
  before: '21:00'
action:
  - service: script.notify_speech
    data:
      media_player: media_player.living_room_speaker
      message: >-
        {%- set message = [
          "Just a head's up, [name] is done at Costco.",
          "[name] is on the way home from Costco."
        ]|random -%}
        {%- set name = trigger.to_state.friendly_name -%}
        {{ message|replace("[name]",name) }}

  # Cool down timer. When "mode: single" this stops this automation from running more often than this.
  - delay:
      minutes: 5
