---
alias: '[Presense] Amy Leaving Work'
mode: single
trigger:
  platform: zone
  event: leave
  zone: zone.cabelas
  entity_id: person.amy
condition:
  condition: time
  after: '15:00'
action:
  - service: script.notify_mobile
    data:
      who: 'josh'
      title: '{{ trigger.to_state.friendly_name }} Leaving Work'
      message: >
        {{ [
          "Just a head's up, {{ trigger.to_state.friendly_name }} is heading home from work.",
          "{{ trigger.to_state.friendly_name }} is on their way home from work."
        ]|random }}
      image: '/media/local/photos/{{ trigger.to_state.friendly_name|lower }}.jpg'
      group: 'presense'

  - service: script.notify_speech
    data:
      media_player: media_player.living_room_speaker
      message: >-
        {% set name = trigger.to_state.friendly_name %}
        {% set message = [
          "Just a head's up, [name1] is heading home from work.",
          "Your [name2] is on the way home from work."
        ]|random %}
        {% if ['name2'] in message %}
          {% if name == "Amy" %}
            {% set name = "mom" %}
          {% elif name == "Joshua" %}
            {% set name = "dad" %}
          {% endif %}
        {% endif %}
        {{ message|replace("[name1]",name)|replace("[name2]",name) }}

  # Cool down timer. When "mode: single" this stops this automation from running more often than this.
  - delay:
      minutes: 60
