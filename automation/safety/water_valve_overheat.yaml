---
id: water_valve_overheat
alias: '[Water] Valve Overheated'
description: 'Sends a notification if the water shut-off valve overheats'

trigger:
  platform: state
  entity_id: binary_sensor.water_main_heat_alarm_overheat_detected
  to: 'on'

variables:
  title: 'Water Valve Overheated'
  message: 'The water main shut-off valve has overheated.'

action:
  - service: script.notify_web
    data:
      title: '{{ title }}'
      message: '{{ message }}'
      id: 'water-leak'

  - service: script.notify_mobile
    data:
      who: 'parents'
      title: '{{ title }}'
      message: '{{ message }}'
      icon: '/local/icons/water-alert.png'
      group: 'water-leak'
      url: 'lovelace/utilities'
      actions:
        - action: 'turn_on_water'
          title: 'Turn Water Main On'

  - service: script.notify_join
    data:
      who: 'shield_all'
      title: '{{ title }}'
      message: '{{ message }}'
      icon: 'local/icons/water-alert.png'

  - service: script.notify_speech
    data:
      media_player: group.google_speakers
      message: '{{ message }}'
