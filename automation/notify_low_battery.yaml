###########################################################
# Automation: Notify Sensor Low Battery
###########################################################

- alias: "[Notify] Sensor Low Battery"
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id: zwave.front_door
      value_template: '{{ state.attributes.battery_level }}'
      below: 20
    - platform: numeric_state
      entity_id: zwave.garage_entry_door
      value_template: '{{ state.attributes.battery_level }}'
      below: 20
    - platform: numeric_state
      entity_id: zwave.sliding_door
      value_template: '{{ state.attributes.battery_level }}'
      below: 20
    - platform: numeric_state
      entity_id: zwave.garage_outside_door
      value_template: '{{ state.attributes.battery_level }}'
      below: 20
    - platform: numeric_state
      entity_id: zwave.kitchen_motion
      value_template: '{{ state.attributes.battery_level }}'
      below: 20
  action:
    - service: notify.phone_j
      data_template:
        title: Low Battery
        message: "{{ trigger.entity_id.split('.')[1].split('_sensor')[0].lower().replace('_', ' ').title() }} batteries are at {{ trigger.to_state.state }}"
        data:
          icon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/battery-alert.png"
          smallicon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/home-assistant.png"
    - service: persistent_notification.create
      data:
        title: Low Battery
        message: "{{ trigger.entity_id.split('.')[1].split('_sensor')[0].lower().replace('_', ' ').title() }} batteries are at {{ trigger.to_state.state }}"
        notification_id: low_battery
