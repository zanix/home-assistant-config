###########################################################
# Automation: [Notify] Update Available
###########################################################

- alias: "[Notify] Update Available"
  hide_entity: true
  trigger:
    - platform: state
      entity_id: updater.updater
  condition:
    - condition: template
      value_template: "{{ states('updater.updater') != 'unknown' }}"
  action:
    - service: notify.phone_user1
      data_template:
        title: Update Available
        message: "Home Assistant {{ states('updater.updater') }} is available. - {{ as_timestamp(now()) | timestamp_custom('%I:%M %p %b %d, %Y', true) }}"
        data:
          icon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/update.png"
          smallicon: "https://raw.githubusercontent.com/zanix/home-assistant-config/master/www/icons/home-assistant.png"
    - service: persistent_notification.create
      data:
        title: Update Available
        message: "Home Assistant {{ states('updater.updater') }} is available. - {{ as_timestamp(now()) | timestamp_custom('%I:%M %p %b %d, %Y', true) }}"
        notification_id: update_available
