---
id: printer_toner_low
alias: 'Printer Low Toner'
description: 'Sends a notification when the printer toner is low'

trigger:
  platform: numeric_state
  entity_id:
    - sensor.canon_mf743c_black_toner
    - sensor.canon_mf743c_cyan_toner
    - sensor.canon_mf743c_magenta_toner
    - sensor.canon_mf743c_yellow_toner
  below: 7.0

condition:
  - condition: template
    value_template: "{{ trigger.to_state.state != 'unknown' and trigger.to_state.state != 'unavailable' }}"

variables:
  message: 'The {{ trigger.to_state.attributes.friendly_name }} is low'

action:
  - service: script.notify_web
    data:
      title: 'Printer Alert'
      message: '{{ message }}'
      id: 'printer-toner-low'

  - service: script.notify_mobile
    data:
      who: 'josh'
      title: 'Printer Alert'
      message: '{{ message }}'
      icon: '/local/icons/printer-alert.png'
      group: 'system'
      tag: 'printer-toner-low'
      url: 'lovelace/computers'
