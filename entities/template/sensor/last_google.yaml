---
# The template integration allows creating entities which derive their values
# from other data. This is done by specifying templates for properties of an
# entity, like the name or the state.
#
# https://www.home-assistant.io/integrations/template/
#
sensor:
  - name: Last Google
    icon: mdi:google-home
    state: |
      {% set list = namespace(dates="",speakers="") %}
      {% set media_player = "group.google_speakers" %}
      {% set speakers = expand(media_player) | map(attribute='entity_id') | list %}

      {% for speaker in speakers %}
        {% set list.dates = list.dates ~ " " ~ as_timestamp(states[speaker].last_updated) %}
        {% set list.speakers = list.speakers ~ " " ~ states[speaker].entity_id %}
      {% endfor %}
      {% set list.dates = list.dates | trim %}
      {% set list.speakers = list.speakers | trim %}
      {% set list.speakers = list.speakers.split(" ") %}

      {% for date in list.dates.split(" ") if date == list.dates.split(" ")|min %}
        {{ list.speakers[loop.index] }}
      {% endfor %}
