---
# The template integration allows creating entities which derive their values
# from other data. This is done by specifying templates for properties of an
# entity, like the name or the state.
#
# https://www.home-assistant.io/integrations/template/
#
sensor:
  - name: Forecast
    state: >-
      {% if states.weather.openweathermap.state and states('weather.openweathermap') != 'None' %}
        {% set hour = now().hour|int %}
        {% if hour < 17 %}
          Today's forecast is {{ state_attr('weather.openweathermap', 'forecast')[0]['condition']|replace('clear','clear ')|replace('partly','partly ') }}, with a high of {{ state_attr('weather.openweathermap', 'forecast')[0]['temperature']|round }}.
        {% else %}
          Tomorrow's forecast is {{ state_attr('weather.openweathermap', 'forecast')[1]['condition']|replace('clear','clear ')|replace('partly','partly ') }}, with a high of {{ state_attr('weather.openweathermap', 'forecast')[1]['temperature']|round }}
          {%- if state_attr('weather.openweathermap', 'forecast')[0]['temperature']|round > 0 %}, and a low of {{ state_attr('weather.openweathermap', 'forecast')[0]['temperature']|round }}{% endif %}.
        {% endif %}
      {% endif %}
