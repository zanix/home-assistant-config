---
# The template integration allows creating entities which derive their values
# from other data. This is done by specifying templates for properties of an
# entity, like the name or the state.
#
# https://www.home-assistant.io/integrations/template/
#
sensor:
  - name: HACS Updates
    icon: >-
      {% set updates = expand(integration_entities('hacs'))
        | selectattr('state', '==', 'on')
        | map(attribute='entity_id')
        | list
        | count
      %}
      {% if updates == 0 %}
        mdi:package-check
      {% else %}
        mdi:package-up
      {% endif %}
    state: >-
      {{ expand(integration_entities('hacs'))
        | selectattr('state', '==', 'on')
        | map(attribute='entity_id')
        | list
        | count
      }}
    attributes:
      entity_id: >-
        {{ expand(integration_entities('hacs'))
          | selectattr('state', '==', 'on')
          | map(attribute='entity_id')
          | list
        }}
      in_progress: >-
        {{ expand(integration_entities('hacs'))
          | selectattr('attributes.in_progress', '!=', false)
          | map(attribute='entity_id')
          | list
        }}
