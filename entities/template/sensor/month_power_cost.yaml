---
# The template integration allows creating entities which derive their values
# from other data. This is done by specifying templates for properties of an
# entity, like the name or the state.
#
# https://www.home-assistant.io/integrations/template/
#
sensor:
  - name: Month Power Cost
    unit_of_measurement: "USD"
    icon: mdi:currency-usd
    availability: "{{ not is_state('sensor.home_123_1mon', 'unavailable') }}"
    state: >
      {%- set summer_offpeak = (states('sensor.monthly_energy_summer_offpeak')|float) * (states('input_text.tariff_summer_offpeak')|float) -%}
      {%- set summer_peak = (states('sensor.monthly_energy_summer_peak')|float) * (states('input_text.tariff_summer_peak')|float) -%}
      {%- set winter_offpeak = (states('sensor.monthly_energy_winter_offpeak')|float) * (states('input_text.tariff_winter_offpeak')|float) -%}
      {%- set winter_peak = (states('sensor.monthly_energy_winter_peak')|float) * (states('input_text.tariff_winter_peak')|float) -%}
      {{ (summer_offpeak + summer_peak + winter_offpeak + winter_peak)|round(2) }}
