---
# Publish solar production data to PVOutput.
#
# https://www.home-assistant.io/integrations/shell_command/
#
pvoutputcurl: >-
  curl \
    -d "d={{ now().strftime("%Y%m%d") }}" \
    -d "t={{ now().strftime("%H:%M") }}" \
  {%- if states("sensor.pv_power") != "unknown" %}
    -d "v2={{ states("sensor.pv_power")|round(0) }}" \
  {%-endif %}
  {%- if states("sensor.grid_power") != "unknown" %}
    -d "v4={{ states("sensor.grid_power")|round(0) }}" \
  {%- endif %}
  {%- if states("sensor.openweathermap_temperature") != "unknown" %}
    -d "v5={{ ((states("sensor.openweathermap_temperature")|float - 32) * 0.5556)|round(2) }}" \
  {%- endif %}
  {%- if states("sensor.ac_output_voltage") != "unknown" %}
    -d "v6={{ states("sensor.ac_output_voltage")|float }}" \
  {%- endif %}
    -H "X-Pvoutput-Apikey: {{ states("input_text.pvoutput_apikey") }}" \
    -H "X-Pvoutput-SystemId: {{ states("input_text.pvoutput_systemid") }}" \
    https://pvoutput.org/service/r2/addstatus.jsp
