---
# Publish solar production data to PVOutput.
#
# https://www.home-assistant.io/integrations/shell_command/
#
pvoutputcurl: >-
  curl \
    -d "d={{ now().strftime("%Y%m%d") }}" \
    -d "t={{ now().strftime("%H:%M") }}" \
  {%- if not states("sensor.pv_power") in ["unknown", "unavailable"] %}
    -d "v2={{ states("sensor.pv_power") | round(0) }}" \
  {%-endif %}
  {%- if not states("sensor.load_power") in ["unknown", "unavailable"] %}
    -d "v4={{ states("sensor.load_power") | round(0) }}" \
  {%- endif %}
  {%- if not states("sensor.openweathermap_temperature") in ["unknown", "unavailable"] %}
    -d "v5={{ ((states("sensor.openweathermap_temperature") | float - 32) * 0.5556) | round(2) }}" \
  {%- endif %}
  {%- if not states("sensor.ac_output_voltage") in ["unknown", "unavailable"] %}
    -d "v6={{ states("sensor.ac_output_voltage") | float }}" \
  {%- endif %}
    -H "X-Pvoutput-Apikey: {{ states("input_text.pvoutput_apikey") }}" \
    -H "X-Pvoutput-SystemId: {{ states("input_text.pvoutput_systemid") }}" \
    https://pvoutput.org/service/r2/addstatus.jsp
