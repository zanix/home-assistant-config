---
# Turns on a Family Room activity and adjusts the lights.
#
# https://www.home-assistant.io/integrations/script/
#
family_room_play_mode:
  alias: 'Family Room Play Mode'
  description: 'Turns on a Family Room activity and adjusts the lights'
  icon: mdi:remote-tv

  fields:
    activity:
      description: 'Harmony activity to run'
      example: 'Computer'
      selector:
        select:
          options:
            - Computer
            - PS4
            - PS3
            - XBox
            - Shield TV

  sequence:
    - service: remote.turn_on
      data_template:
        entity_id: remote.family_room
        activity: '{{ activity|default("Computer") }}'

    - service: homeassistant.turn_off
      data:
        entity_id: switch.stair_light

    - choose:
        - conditions:
            or:
              - condition: sun
                after: sunset
                after_offset: '-01:00:00'
              - condition: sun
                before: sunrise
          sequence:
            - parallel:
                - service: light.turn_on
                  target:
                    entity_id: light.family_room
                  data:
                    transition: 1
                    brightness_pct: 25
                - service: light.turn_on
                  target:
                    entity_id: light.play_space
                  data:
                    transition: 1
                    brightness_pct: 12

      default:
        - parallel:
            - service: light.turn_on
              target:
                entity_id: light.family_room
              data:
                transition: 1
                brightness_pct: 25
            - service: light.turn_on
              target:
                entity_id: light.play_space
              data:
                transition: 1
                brightness_pct: 100
