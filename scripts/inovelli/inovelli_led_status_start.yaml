---
inovelli_led_status_start:
  alias: 'Inovelli LED (Status Start)'
  description: 'Set a LED effect and check for state'
  icon: mdi:led-off
  mode: parallel

  fields:
    entity_id:
      description: 'Light or switch'
      example: 'switch.inovelli_lzw30_sn_switch_red_series'
      selector:
        device:
          integration: zwave_js
          manufacturer: Inovelli
    color_start:
      description: '[Start] LED Color'
      example: 'Red'
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_start:
      description: '[Start] Effect to use'
      example: Pulse
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_start:
      description: '[Start] LED brightness'
      example: '10'
      selector:
        number:
          min: 1
          max: 10
    duration:
      description: 'How long should the effect run?'
      example: 10 seconds
      selector:
        select:
          options: !include ../../templates/inovelli_durations_select.yaml
    color_end:
      description: '[End] LED Color'
      example: 'Red'
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_end:
      description: '[End] Effect to use'
      example: Pulse
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_end:
      description: '[End] LED brightness'
      example: '10'
      selector:
        number:
          min: 1
          max: 10

  variables:
    entity_id: '{{ entity_id|default("switch.inovelli_lzw30_sn_switch_red_series") }}'
    color: |
      {%- if color is not number -%}
        {{ color|default("Yellow")|title }}
      {%- else -%}
        {{ color|int }}
      {%- endif -%}
    durations: !include ../../templates/inovelli_durations_values.yaml
    duration: '{{ duration|default("15 Seconds",true)|title }}'

  sequence:
    - variables:
        duration_int: '{{ durations[duration|title] }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_id }}'
        color: '{{ color_start }}'
        effect: '{{ effect_start }}'
        duration: '{{ duration }}'
        level: '{{ level_start }}'

    - delay:
        seconds: '{{ duration_int }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_id }}'
        color: '{{ color_end }}'
        effect: '{{ effect_end }}'
        duration: 'Indefinately'
        level: '{{ level_end }}'
