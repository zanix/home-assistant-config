---
inovelli_led_status_start:
  alias: 'Inovelli LED (Status Start)'
  description: 'Set a LED effect and check for state.'
  icon: mdi:led-off
  mode: parallel

  fields:
    entity_id:
      name: Light switch
      description: 'Light or switch entity.'
      example: 'switch.inovelli_lzw30_sn_switch_red_series'
      required: true
      selector:
        device:
          integration: zwave_js
          manufacturer: Inovelli
    color_start:
      name: '[Start] LED Color'
      example: 'Red'
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_start:
      name: '[Start] Effect'
      example: Pulse
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_start:
      name: '[Start] LED brightness'
      example: '10'
      selector:
        number:
          min: 1
          max: 10
    duration:
      name: 'Duration'
      description: 'How long should the effect run?'
      default: 15 Seconds
      example: 10 seconds
      selector:
        select:
          options: !include ../../templates/inovelli_durations_select.yaml
    color_end:
      name: '[End] LED Color'
      example: 'Red'
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_end:
      name: '[End] Effect'
      example: Pulse
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_end:
      name: '[End] LED brightness'
      example: '10'
      required: true
      selector:
        number:
          min: 1
          max: 10

  variables:
    durations: !include ../../templates/inovelli_durations_values.yaml
    duration: '{{ duration|default("15 Seconds",true)|title }}'

  sequence:
    - variables:
        duration_int: '{{ durations[duration|title] }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_id }}'
        color: '{{ color_start }}'
        effect: '{{ effect_start }}'
        duration: '{{ duration }}'
        level: '{{ level_start }}'

    - delay:
        seconds: '{{ duration_int }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_id }}'
        color: '{{ color_end }}'
        effect: '{{ effect_end }}'
        duration: 'Indefinately'
        level: '{{ level_end }}'
