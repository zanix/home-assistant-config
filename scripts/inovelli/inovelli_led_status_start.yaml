---
inovelli_led_status_start:
  alias: 'Inovelli LED (Status Start)'
  description: 'Set a LED effect, wait for a delay, and set to a new effect.'
  icon: mdi:led-off
  mode: parallel

  fields:
    entity_id:
      name: Entities
      description: Inovelli devices to set effects.
      example: light.family_room
      required: true
      selector:
        entity:
          domain:
            - light
            - switch
          integration: zwave_js
          multiple: true
    color_start:
      name: '[Start] LED Color'
      default: Yellow
      example: Yellow
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_start:
      name: '[Start] Effect'
      example: Pulse
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_start:
      name: '[Start] LED brightness'
      example: '10'
      selector:
        number:
          min: 1
          max: 10
    duration:
      name: 'Duration'
      description: 'How long should the effect run?'
      default: 15 Seconds
      example: 10 seconds
      selector:
        select:
          options: !include ../../templates/inovelli_durations_select.yaml
    color_end:
      name: '[End] LED Color'
      default: Yellow
      example: Yellow
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_colors_select.yaml
    effect_end:
      name: '[End] Effect'
      example: Pulse
      required: true
      selector:
        select:
          options: !include ../../templates/inovelli_effects_select.yaml
    level_end:
      name: '[End] LED brightness'
      example: '10'
      required: true
      selector:
        number:
          min: 1
          max: 10
    enable_debug:
      name: Enable debug output?
      default: false
      selector:
        boolean:

  variables:
    # Set to true to create a "persistent_notification" with debugging information.
    debug: '{{ iif(enable_debug is defined, enable_debug, false) }}'

    entity_list: '{{ entity_id }}'
    durations: !include ../../templates/inovelli_durations_values.yaml
    duration: '{{ duration|default("15 Seconds",true)|title }}'

  sequence:
    - variables:
        duration_int: '{{ durations[duration|title] }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_list }}'
        color: '{{ color_start }}'
        effect: '{{ effect_start }}'
        duration: '{{ duration }}'
        level: '{{ level_start }}'
        enable_debug: '{{ debug }}'

    - delay:
        seconds: '{{ duration_int }}'

    - service: script.inovelli_led
      data:
        entity_id: '{{ entity_list }}'
        color: '{{ color_end }}'
        effect: '{{ effect_end }}'
        duration: 'Indefinitely'
        level: '{{ level_end }}'
        enable_debug: '{{ debug }}'
