---
title: Utilities
path: utilities
icon: mdi:factory
panel: true
cards:
  - type: custom:layout-card
    layout_type: grid
    layout:
      grid-template-columns: 33% 33% 33%
      grid-template-rows: auto
      grid-template-areas: |
        "header header header"
        "col1 col2 col3"
        "footer footer col4"
      mediaquery:
        "(max-width: 600px)":
          grid-template-columns: 100%
          grid-template-areas: |
            "header"
            "col1"
            "col2"
            "col3"
            "col4"
            "footer"
        "(max-width: 1000px)":
          grid-template-columns: 50% 50%
          grid-template-areas: |
            "header header"
            "col1 col1"
            "col2 col3"
            "footer col4"
    cards:

      - type: custom:stack-in-card
        title: Water Works
        view_layout:
          grid-area: col1
        cards:

          - type: grid
            square: false
            columns: 2
            cards:
              - type: entity
                entity: binary_sensor.water_main_water_alarm_water_leak_detected
                name: Water Main
              - type: entity
                entity: binary_sensor.fridge_leak_sensor_water_alarm_water_leak_detected
                name: Fridge
              - type: entity
                entity: binary_sensor.laundry_leak_sensor_water_alarm_water_leak_detected
                name: Laundry
              - type: entity
                entity: binary_sensor.water_heater_leak_sensor_water_alarm_water_leak_detected
                name: Water Heater
              - type: entity
                entity: binary_sensor.basement_bathroom_leak_sensor_water_alarm_water_leak_detected
                name: Basement Bathroom
              - type: entity
                entity: binary_sensor.bathroom_leak_sensor_water_alarm_water_leak_detected
                name: Bathroom
              - type: entity
                entity: binary_sensor.master_bathroom_leak_sensor_water_alarm_water_leak_detected
                name: Master Bathroom
                # - type: entity
                #   entity: binary_sensor.dishwasher_leak_sensor_water_alarm_water_leak_detected
                #   name: Dishwasher

          - type: custom:button-card
            template: common
            tap_action:
              action: more-info
            double_tap_action:
              action: toggle
            entity: switch.water_main
            icon: mdi:valve
            name: Water Main Valve
            styles:
              icon:
                - width: 100%
            state:
              - value: 'on'
                icon: mdi:valve-open
                styles:
                  icon:
                    - color: var(--label-badge-green)
              - value: 'off'
                icon: mdi:valve-closed
                styles:
                  icon:
                    - color: var(--label-badge-red)

          - type: custom:bar-card
            style: |-
              bar-card-name,
              bar-card-value {
                text-shadow: 1px 1px #0005;
              }
              bar-card-currentbar,
              bar-card-backgroundbar {
                border-radius: 4px;
              }
            entity: sensor.salt_level
            name: Water Softener Salt Level
            decimal: 1
            animation:
              state: 'on'
            positions:
              icon: "off"
              indicator: "off"
            severity:
              - color: red
                from: 0
                to: 19
              - color: orange
                from: 20
                to: 39
              - color: "#f1de00"
                from: 40
                to: 59
              - color: yellowgreen
                from: 60
                to: 79
              - color: green
                from: 80
                to: 100

      - type: entities
        title: Rachio
        show_header_toggle: false
        view_layout:
          grid-area: col2
        entities:
          - switch.rachio_standby_mode
          - switch.zone_1_front_north
          - switch.zone_2_front_middle
          - switch.zone_3_north_fence
          - switch.zone_4_back_middle_south
          - switch.zone_5_back_south
          - switch.zone_6_front_south
          - switch.zone_7_flower_beds

      - type: entities
        title: Solar Production
        show_header_toggle: false
        view_layout:
          grid-area: col3
        entities:
          - sensor.solar_current
          - sensor.solar_today
          - sensor.solar_this_month
          - sensor.solar_this_year
          - sensor.solar_lifetime

      - type: custom:apexcharts-card
        view_layout:
          grid-area: footer
        experimental:
          brush: true
          color_threshold: true
        graph_span: 7d
        header:
          title: Power Draw
          show: true
          show_states: true
          colorize_states: true
        all_series_config:
          stroke_width: 4
          type: line
          group_by:
            func: avg
            duration: 5min
          extend_to: 'now'
          float_precision: 2
        stacked: true
        brush:
          selection_span: 12h
          apex_config:
            xaxis:
              tooltip:
                enabled: false
            grid:
              borderColor: '#7B7B7B'
            chart:
              foreColor: '#7B7B7B'
              toolbar:
                show: false
        series:
          - entity: sensor.home_123_1min
            show:
              in_brush: true
            color_threshold:
              - value: -3000
                color: blue
              - value: -50
                color: lime
              - value: 50
                color: orange
              - value: 6000
                color: red
        apex_config:
          xaxis:
            tooltip:
              enabled: false
          grid:
            borderColor: '#7B7B7B'
          chart:
            foreColor: '#7B7B7B'
            toolbar:
              show: false

      - type: custom:stack-in-card
        title: Power Usage
        view_layout:
          grid-area: col4
        cards:

          - type: custom:bar-card
            entities:
              - entity: sensor.home_balance_1min
                name: Home Balance
              - entity: sensor.family_room_1_1min
                name: Family Room
              - entity: sensor.dishwasher_disposal_2_1min
                name: Dishwasher / Disposal
              - entity: sensor.refrigerator_3_1min
                name: Fridge/ Outlets
              - entity: sensor.theater_room_4_1min
                name: Theater Room
              - entity: sensor.washer_5_1min
                name: Washer
              - entity: sensor.basement_bedrooms_6_1min
                name: Basement Bedrooms
              - entity: sensor.master_bedroom_7_1min
                name: Master Bedroom
              - entity: sensor.bedrooms_8_1min
                name: Bedrooms
              - entity: sensor.range_9_1min
                name: Range
              - entity: sensor.dryer_10_1min
                name: Dryer
              - entity: sensor.garage_outlets_11_1min
                name: Garage Outlets
              - entity: sensor.mechanical_12_1min
                name: Utility
              - entity: sensor.entry_13_1min
                name: Entry
              - entity: sensor.air_conditioner_14_1min
                name: A/C
            style: |-
              bar-card-name,
              bar-card-value {
                text-shadow: 1px 1px #0005;
              }
              bar-card-currentbar,
              bar-card-backgroundbar {
                border-radius: 4px;
              }
            entity_row: true
            max: 5000
            decimal: 1
            height: '30px'
            animation:
              state: 'on'
            positions:
              icon: "off"
              indicator: "inside"
            severity:
              - color: green
                from: 0
                to: 200
              - color: yellowgreen
                from: 201
                to: 500
              - color: "#f1de00"
                from: 501
                to: 1000
              - color: orange
                from: 1001
                to: 2000
              - color: red
                from: 2001
                to: 9000
