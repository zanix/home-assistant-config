import{s as e,cm as i,y as t,b7 as s,b8 as a,b9 as r,bb as o,bP as d,bE as l,bQ as n,bL as h,l as u,bR as c,bT as g,bO as v,cM as f,cj as w,c9 as p,cN as m,cO as y,cP as C}from"./card-b71c94d3.js";import{L as _,A as b,i as $,w as M,p as R,h as x,M as P}from"./media-ea5fcd89.js";import"./ha-hls-player-3b15cd90.js";import"./surround-b1c1a8e7.js";import{u as q}from"./media-layout-8e0c974f.js";import{a as V,c as S,M as T}from"./media-to-view-e0e2d1f6.js";import{V as W}from"./media-694b9ac5.js";let I=class extends e{render(){if(this.hass&&this.view&&this.viewerConfig&&this.cameraManager&&this.cardWideConfig){if(!this.view.queryResults?.hasResults()){const e=this.view.getDefaultMediaType();if(!e)return;return"recordings"===e?V(this,this.hass,this.cameraManager,this.cardWideConfig,this.view,{targetView:"recording",select:"latest"}):S(this,this.hass,this.cameraManager,this.cardWideConfig,this.view,{targetView:"media",mediaType:e,select:"latest"}),i({cardWideConfig:this.cardWideConfig})}return t` <frigate-card-surround
      .hass=${this.hass}
      .view=${this.view}
      .thumbnailConfig=${this.viewerConfig.controls.thumbnails}
      .timelineConfig=${this.viewerConfig.controls.timeline}
      .cameraManager=${this.cameraManager}
      .cardWideConfig=${this.cardWideConfig}
    >
      <frigate-card-viewer-carousel
        .hass=${this.hass}
        .view=${this.view}
        .viewerConfig=${this.viewerConfig}
        .resolvedMediaCache=${this.resolvedMediaCache}
        .cameraManager=${this.cameraManager}
        .cardWideConfig=${this.cardWideConfig}
      >
      </frigate-card-viewer-carousel>
    </frigate-card-surround>`}}static get styles(){return s(":host {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\nfrigate-card-viewer-carousel {\n  flex: 1;\n  min-height: 0;\n}")}};a([r({attribute:!1})],I.prototype,"hass",void 0),a([r({attribute:!1})],I.prototype,"view",void 0),a([r({attribute:!1})],I.prototype,"viewerConfig",void 0),a([r({attribute:!1})],I.prototype,"resolvedMediaCache",void 0),a([r({attribute:!1})],I.prototype,"cameraManager",void 0),a([r({attribute:!1})],I.prototype,"cardWideConfig",void 0),I=a([o("frigate-card-viewer")],I);const k="frigate-card-viewer-provider";let F=class extends e{constructor(){super(...arguments),this._refMediaCarousel=d()}updated(e){if(super.updated(e),e.has("view")){const i=e.get("view");this.view?.context?.mediaViewer!==i?.context?.mediaViewer&&this._seekHandler()}}_getTransitionEffect(){return this.viewerConfig?.transition_effect??l.media_viewer.transition_effect}_getPlayer(e){return e||(e=this._refMediaCarousel.value?.frigateCardCarousel()?.getCarouselSelected()?.element),e?.querySelector(k)??null}_getPlugins(){return[...this.view?.queryResults?.getResultsCount()?[n({forceWheelAxis:"y"})]:[],_({...this.viewerConfig?.lazy_load&&{lazyLoadCallback:(e,i)=>this._lazyloadSlide(i)}}),b({playerSelector:k,...this.viewerConfig?.auto_play&&{autoPlayCondition:this.viewerConfig.auto_play},...this.viewerConfig?.auto_pause&&{autoPauseCondition:this.viewerConfig.auto_pause},...this.viewerConfig?.auto_mute&&{autoMuteCondition:this.viewerConfig.auto_mute},...this.viewerConfig?.auto_unmute&&{autoUnmuteCondition:this.viewerConfig.auto_unmute}})]}_getMediaNeighbors(){const e=this.view?.queryResults?.getSelectedIndex()??null,i=this.view?.queryResults?.getResultsCount()??0;if(!this.view||!this.view.queryResults||null===e)return[null,null];return[e>0?this.view.queryResults.getResult(e-1):null,e+1<i?this.view.queryResults.getResult(e+1):null]}_setViewHandler(e){this._setViewSelectedIndex(e.detail.index)}_setViewSelectedIndex(e){if(!this.view?.queryResults)return;const i=this.view.queryResults.getSelectedIndex();if(null===i||i===e)return;const t=this.view?.queryResults?.clone().selectResult(e);if(!t)return;const s=t.getSelectedResult()?.getCameraID();this.view?.evolve({queryResults:t,...s&&{camera:s}}).dispatchChangeEvent(this)}_lazyloadSlide(e){e instanceof HTMLSlotElement&&(e=e.assignedElements({flatten:!0})[0]);const i=e?.querySelector("frigate-card-viewer-provider");i&&(i.disabled=!1)}_getSlides(){if(!this.view||!this.view.queryResults)return[];const e=[];for(let i=0;i<this.view.queryResults.getResultsCount();++i){const t=this.view.queryResults.getResult(i);if(t){const s=this._renderMediaItem(t,i);s&&(e[i]=s)}}return e}willUpdate(e){e.has("viewerConfig")&&q(this,this.viewerConfig?.layout)}render(){const e=this.view?.queryResults?.getResultsCount()??0;if(!e)return h(this,u("common.no_media"),"info",{icon:"mdi:multimedia"});const i=this.view?.queryResults?.getSelectedResult()??this.view?.queryResults?.getResult(e-1);if(!(this.hass&&this.cameraManager&&i&&this.view&&this.view.queryResults))return;const[s,a]=this._getMediaNeighbors(),r=e=>{const i=this.view?.queryResults?.getSelectedIndex()??null;if(!this.view||!this.view?.queryResults||null===i)return;const t="previous"===e?i-1:i+1;t>=0&&t<this.view.queryResults.getResultsCount()&&this._setViewSelectedIndex(t)},o=this.cameraManager.getCameraMetadata(this.hass,i.getCameraID());return t` <frigate-card-media-carousel
      ${c(this._refMediaCarousel)}
      .carouselOptions=${$([this.viewerConfig],(()=>({draggable:this.viewerConfig?.draggable??!0})))}
      .carouselPlugins=${$([this.viewerConfig,this.view.queryResults.getResults()],this._getPlugins.bind(this))}
      .label=${i.getTitle()??void 0}
      .logo=${o?.engineLogo}
      .titlePopupConfig=${this.viewerConfig?.controls.title}
      .selected=${this.view?.queryResults?.getSelectedIndex()??0}
      transitionEffect=${this._getTransitionEffect()}
      @frigate-card:media-carousel:select=${this._setViewHandler.bind(this)}
      @frigate-card:media:loaded=${this._seekHandler.bind(this)}
    >
      <frigate-card-next-previous-control
        slot="previous"
        .hass=${this.hass}
        .direction=${"previous"}
        .controlConfig=${this.viewerConfig?.controls.next_previous}
        .thumbnail=${s?.getThumbnail()??void 0}
        .label=${s?.getTitle()??""}
        ?disabled=${!s}
        @click=${e=>{r("previous"),g(e)}}
      ></frigate-card-next-previous-control>
      ${$(this.view?.queryResults?.getResults(),(()=>this._getSlides()))}
      <frigate-card-next-previous-control
        slot="next"
        .hass=${this.hass}
        .direction=${"next"}
        .controlConfig=${this.viewerConfig?.controls.next_previous}
        .thumbnail=${a?.getThumbnail()??void 0}
        .label=${a?.getTitle()??""}
        ?disabled=${!a}
        @click=${e=>{r("next"),g(e)}}
      ></frigate-card-next-previous-control>
    </frigate-card-media-carousel>`}async _seekHandler(){const e=this.view?.context?.mediaViewer?.seek,i=this.view?.queryResults?.getSelectedResult();if(!this.hass||!i||!e)return;const t=await(this.cameraManager?.getMediaSeekTime(this.hass,i,e))??null,s=this._getPlayer();s&&null!==t&&s.seek(t)}_renderMediaItem(e,i){return this.hass&&this.view&&this.viewerConfig?t` <div class="embla__slide">
      <frigate-card-viewer-provider
        .hass=${this.hass}
        .view=${this.view}
        .media=${e}
        .viewerConfig=${this.viewerConfig}
        .resolvedMediaCache=${this.resolvedMediaCache}
        .cameraManager=${this.cameraManager}
        .disabled=${this.viewerConfig.lazy_load}
        .cardWideConfig=${this.cardWideConfig}
        @frigate-card:media:loaded=${e=>{M(i,e)}}
      ></frigate-card-viewer-provider>
    </div>`:null}static get styles(){return s(".embla__slide {\n  height: 100%;\n  flex: 0 0 100%;\n}")}};a([r({attribute:!1})],F.prototype,"hass",void 0),a([r({attribute:!1})],F.prototype,"view",void 0),a([r({attribute:!1,hasChanged:v})],F.prototype,"viewerConfig",void 0),a([r({attribute:!1})],F.prototype,"resolvedMediaCache",void 0),a([r({attribute:!1})],F.prototype,"cardWideConfig",void 0),a([r({attribute:!1})],F.prototype,"cameraManager",void 0),F=a([o("frigate-card-viewer-carousel")],F);let j=class extends e{constructor(){super(...arguments),this.disabled=!1,this._refFrigateCardMediaPlayer=d(),this._refVideoProvider=d()}async play(){R(this,this._refFrigateCardMediaPlayer.value??this._refVideoProvider.value)}pause(){(this._refFrigateCardMediaPlayer.value||this._refVideoProvider.value)?.pause()}mute(){this._refFrigateCardMediaPlayer.value?this._refFrigateCardMediaPlayer.value?.mute():this._refVideoProvider.value&&(this._refVideoProvider.value.muted=!0)}unmute(){this._refFrigateCardMediaPlayer.value?this._refFrigateCardMediaPlayer.value?.mute():this._refVideoProvider.value&&(this._refVideoProvider.value.muted=!1)}isMuted(){return this._refFrigateCardMediaPlayer.value?this._refFrigateCardMediaPlayer.value?.isMuted()??!0:!this._refVideoProvider.value||this._refVideoProvider.value.muted}seek(e){if(this._refFrigateCardMediaPlayer.value)return this._refFrigateCardMediaPlayer.value.seek(e);this._refVideoProvider.value&&(x(this._refVideoProvider.value),this._refVideoProvider.value.currentTime=e)}async _dispatchRelatedClipView(){if(!(this.hass&&this.view&&this.cameraManager&&this.media&&f.isEvent(this.media)&&w.areEventQueries(this.view.query)))return;const e=this.view.query.clone();e.convertToClipsQueries();const i=e.getQueries();if(!i)return;let t;try{t=await this.cameraManager.executeMediaQueries(this.hass,i)}catch(e){return void p(e)}if(!t)return;const s=new T(t);s.selectResultIfFound((e=>e.getID()===this.media?.getID())),s.hasSelectedResult()&&this.view.evolve({view:"media",query:e,queryResults:s}).dispatchChangeEvent(this)}willUpdate(e){const i=this.media?this.media.getContentID():null;!((e.has("disabled")||e.has("media")||e.has("viewerConfig")||e.has("resolvedMediaCache")||e.has("hass"))&&this.hass&&i)||this.resolvedMediaCache?.has(i)||this.viewerConfig?.lazy_load&&this.disabled||m(this.hass,i,this.resolvedMediaCache).then((()=>{this.requestUpdate()}))}render(){if(this.disabled||!this.media||!this.hass||!this.view||!this.viewerConfig)return;const e=this.media.getContentID(),s=e?this.resolvedMediaCache?.get(e):null;return s?f.isVideo(this.media)?this.media.getVideoContentType()===W.HLS?t`<frigate-card-ha-hls-player
            ${c(this._refFrigateCardMediaPlayer)}
            allow-exoplayer
            aria-label="${this.media.getTitle()??""}"
            ?autoplay=${!1}
            controls
            muted
            playsinline
            title="${this.media.getTitle()??""}"
            url=${y(this.hass,s?.url)??""}
            .hass=${this.hass}
          >
          </frigate-card-ha-hls-player>`:t`
            <video
              ${c(this._refVideoProvider)}
              aria-label="${this.media.getTitle()??""}"
              title="${this.media.getTitle()??""}"
              muted
              controls
              playsinline
              ?autoplay=${!1}
              @loadedmetadata=${e=>{e.target&&x(e.target,P)}}
              @loadeddata=${e=>{C(this,e)}}
            >
              <source
                src=${y(this.hass,s?.url)??""}
                type="video/mp4"
              />
            </video>
          `:t`<img
          aria-label="${this.media.getTitle()??""}"
          src="${y(this.hass,s?.url)??""}"
          title="${this.media.getTitle()??""}"
          @click=${()=>{this.viewerConfig?.snapshot_click_plays_clip&&this._dispatchRelatedClipView()}}
          @load=${e=>{C(this,e)}}
        />`:i({cardWideConfig:this.cardWideConfig})}static get styles(){return s(":host {\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n\nimg,\nvideo,\nfrigate-card-ha-hls-player {\n  display: block;\n  width: 100%;\n  height: 100%;\n  object-fit: var(--frigate-card-media-layout-fit, contain);\n  object-position: var(--frigate-card-media-layout-position-x, 50%) var(--frigate-card-media-layout-position-y, 50%);\n}\n\nfrigate-card-progress-indicator {\n  padding: 30px;\n  box-sizing: border-box;\n}")}};a([r({attribute:!1})],j.prototype,"hass",void 0),a([r({attribute:!1})],j.prototype,"view",void 0),a([r({attribute:!1})],j.prototype,"media",void 0),a([r({attribute:!1})],j.prototype,"viewerConfig",void 0),a([r({attribute:!1})],j.prototype,"resolvedMediaCache",void 0),a([r({attribute:!1})],j.prototype,"disabled",void 0),a([r({attribute:!1})],j.prototype,"cameraManager",void 0),a([r({attribute:!1})],j.prototype,"cardWideConfig",void 0),j=a([o(k)],j);export{I as FrigateCardViewer,F as FrigateCardViewerCarousel,j as FrigateCardViewerProvider};
