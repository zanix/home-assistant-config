###########################################################
# Sensor: Package Delivery
###########################################################

- platform: template
  sensors:
    packages_in_transit:
      friendly_name: In Transit
      unit_of_measurement: boxes
      value_template: >
        {% macro in_transit(sensor) %}
          {{ sensor.state | int - delivered(sensor) | int - out_for_delivery(sensor) | int }}
        {% endmacro %}
        {% macro out_for_delivery(sensor) %}
          {% if 'out_for_delivery' in sensor.attributes %}
            {{ sensor.attributes.out_for_delivery }}
          {% else %}
            0
          {% endif %}
        {% endmacro %}
        {% macro delivered(sensor) %}
          {% if 'delivered' in sensor.attributes %}
            {{ sensor.attributes.delivered }}
          {% else %}
            0
          {% endif %}
        {% endmacro %}
        {{ in_transit(states.sensor.usps_packages) | int + in_transit(states.sensor.fedex) | int + in_transit(states.sensor.ups) | int }}

    packages_out_for_delivery:
      friendly_name: Out for Delivery
      unit_of_measurement: boxes
      value_template: >
        {% macro out_for_delivery(sensor) %}
          {% if 'out_for_delivery' in sensor.attributes %}
            {{ sensor.attributes.out_for_delivery }}
          {% else %}
            0
          {% endif %}
        {% endmacro %}
        {{ out_for_delivery(states.sensor.usps_packages) | int + out_for_delivery(states.sensor.fedex) | int + out_for_delivery(states.sensor.ups) | int }}

    packages_delivered:
      friendly_name: Delivered
      unit_of_measurement: boxes
      value_template: >
        {% macro delivered(sensor) %}
          {% if 'delivered' in sensor.attributes %}
            {{ sensor.attributes.delivered }}
          {% else %}
            0
          {% endif %}
        {% endmacro %}
        {{ delivered(states.sensor.usps_packages) | int + delivered(states.sensor.fedex) | int + delivered(states.sensor.ups) | int }}
